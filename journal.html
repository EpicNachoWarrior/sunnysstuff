<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Journal Entry</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#5e2a8a; color:#fff; }
    main { max-width:760px; margin:18px auto; padding:18px; background:#fff8dc; color:#000; }
    .meta { color:#333; margin-bottom:10px; }
  </style>
</head>
<body>
  <main>
    <a href="index.html">Back</a>
    <h2>Journal Entry</h2>
    <div id="status">Loading...</div>
    <div id="entry"></div>
  </main>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDe62-Q_WF8oMomsKfonNd3u5jTUhrkaFc",
      authDomain: "journal-1f6a9.firebaseapp.com",
      projectId: "journal-1f6a9",
      storageBucket: "journal-1f6a9.appspot.com",
      messagingSenderId: "1034090685916",
      appId: "1:1034090685916:web:0ba4a554f003c30fd05b19"
    };

    if (typeof firebase === 'undefined') {
      document.getElementById('status').textContent = 'ERROR: Firebase did not load.';
      console.error('Firebase undefined');
    } else {
      try { firebase.initializeApp(firebaseConfig); } catch(e) {}
      const db = firebase.firestore();

      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');
      if (!id) {
        document.getElementById('status').textContent = 'No entry id.';
      } else {
        db.collection('entries').doc(id).get().then(doc => {
          if (!doc.exists) {
            document.getElementById('status').textContent = 'Entry not found.';
            return;
          }
          const d = doc.data();
          function fmt(ts) {
            if (!ts) return '';
            if (ts.toDate) return ts.toDate().toLocaleString(undefined, {dateStyle:'full', timeStyle:'short'});
            return new Date(ts).toLocaleString();
          }
          document.getElementById('status').textContent = fmt(d.timestamp);
          document.getElementById('entry').innerHTML = '<div>' + escapeHtml(d.text) + '</div>';
        }).catch(err => {
          console.error('load entry error', err);
          document.getElementById('status').textContent = 'Error loading entry. Check console.';
        });
      }
    }

    function escapeHtml(str) {
      if (!str) return '';
      return str.replace(/[&<>"']/g, s => {
        const map = {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'};
        return map[s];
      }).replace(/\n/g,'<br>');
    }
  </script>
</body>
</html>
